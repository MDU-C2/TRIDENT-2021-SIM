<?xml version="1.0"?>

<xacro xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:property name="PI" value="3.1415926535897931"/>

  <!-- Body properties -->
  <xacro:property name="front_body_mass" value="0.5"/>
  <xacro:property name="back_body_mass" value="2"/>
  <xacro:property name="middle_body_mass" value="2"/>
  <xacro:property name="back_water_displaced_mass" value="10"/>
  <xacro:property name="middle_water_displaced_mass" value="10"/>
  <xacro:property name="front_water_displaced_mass" value="5"/>
  <xacro:property name="scale" value="0.21"/>
  <xacro:property name="bl1" value=".1" />
  <xacro:property name="bl2" value=".1" />

  <link name='base_link'>
    <pose frame=''>0 0 0 0 -0 0</pose>
    <inertial>
      <pose frame=''>0.0735 0.0924 -0.042 0 -0 0</pose>
      <mass value="3.5"/>
      <inertia ixx="0.1" ixy="0" ixz="0" iyy="1.4" iyz="0" izz="1.4"/>
    </inertial>
    <visual>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <geometry>
        <mesh filename="package://usv_sim/meshes/naiad/base_link.dae" scale="0.21 0.21 0.21" />
      </geometry>
    </visual>
    <collision>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <geometry>
        <mesh filename="package://usv_sim/meshes/naiad/base_link.dae"/>
      </geometry>
    </collision>
    <buoyancy>
      <compensation>${middle_water_displaced_mass/middle_body_mass}</compensation>
      <origin xyz="0 0 0"/>
      <limit radius="0.1"/>
      <damping rpy="${angularDampingXYZ}" xyz="${dampingXYZ}"/>
      <windVelocity>${windType}</windVelocity>
      <frontal_area>0.0</frontal_area>
      <lateral_area>0.012</lateral_area>
      <lateral_length>1.06</lateral_length>
      <waterVelocity>${waterType}</waterVelocity>
    </buoyancy>
  </link>

  <link name='back_l_link'>
    <pose frame=''>0 0 0 0 -0 0</pose>
    <inertial>
      <pose frame=''>-0.126 0 -0.042 0 -0 0</pose>
      <mass value="2"/>
      <inertia ixx="0.1" ixy="0" ixz="0" iyy="1.4" iyz="0" izz="1.4"/>
    </inertial>
    <visual>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <geometry>
        <mesh filename="package://usv_sim/meshes/naiad/backLeft.dae" scale="0.21 0.21 0.21"/>
      </geometry>
    </visual>
    <collision>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <geometry>
        <mesh filename="package://usv_sim/meshes/naiad/backLeft.dae" />
      </geometry>
    </collision>
    <buoyancy>
      <compensation>${back_water_displaced_mass/back_body_mass}</compensation>
      <origin xyz="0 0 0"/>
      <limit radius="0.1"/>
      <damping rpy="${angularDampingXYZ}" xyz="${dampingXYZ}"/>
      <windVelocity>${windType}</windVelocity>
      <frontal_area>0.0</frontal_area>
      <lateral_area>0.012</lateral_area>
      <lateral_length>1.06</lateral_length>
      <waterVelocity>${waterType}</waterVelocity>
    </buoyancy>
  </link>

  <link name='back_r_link'>
    <pose frame=''>0 0 0 0 -0 0</pose>
    <inertial>
      <pose frame=''>-0.126 0 -0.042 0 -0 0</pose>
      <mass value="2"/>
      <inertia ixx="0.1" ixy="0" ixz="0" iyy="1.4" iyz="0" izz="1.4"/>
    </inertial>
    <visual>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <geometry>
        <mesh filename="package://usv_sim/meshes/naiad/backRight.dae" scale="0.21 0.21 0.21"/>
      </geometry>
    </visual>
    <collision>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <geometry>
        <mesh filename="package://usv_sim/meshes/naiad/backRight.dae" />
      </geometry>
    </collision>
    <buoyancy>
      <compensation>${back_water_displaced_mass/back_body_mass}</compensation>
      <origin xyz="0 0 0"/>
      <limit radius="0.1"/>
      <damping rpy="${angularDampingXYZ}" xyz="${dampingXYZ}"/>
      <windVelocity>${windType}</windVelocity>
      <frontal_area>0.0</frontal_area>
      <lateral_area>0.012</lateral_area>
      <lateral_length>1.06</lateral_length>
      <waterVelocity>${waterType}</waterVelocity>
    </buoyancy>
  </link>

  <link name='center_r_link'>
    <pose frame=''>0 0 0 0 -0 0</pose>
    <inertial>
      <pose frame=''>0.0735 -0.0924 -0.042 0 -0 0</pose>
      <mass value="3.5"/>
      <inertia ixx="0.1" ixy="0" ixz="0" iyy="1.4" iyz="0" izz="1.4"/>
    </inertial>
    <visual>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <geometry>
        <mesh filename="package://usv_sim/meshes/naiad/centerRight.dae" scale="0.21 0.21 0.21"/>
      </geometry>
    </visual>
    <collision>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <geometry>
        <mesh filename="package://usv_sim/meshes/naiad/centerRight.dae" />
      </geometry>
    </collision>
    <buoyancy>
      <compensation>${middle_water_displaced_mass/middle_body_mass}</compensation>
      <origin xyz="0 0 0"/>
      <limit radius="0.1"/>
      <damping rpy="${angularDampingXYZ}" xyz="${dampingXYZ}"/>
      <windVelocity>${windType}</windVelocity>
      <frontal_area>0.0</frontal_area>
      <lateral_area>0.012</lateral_area>
      <lateral_length>1.06</lateral_length>
      <waterVelocity>${waterType}</waterVelocity>
    </buoyancy>
  </link>

  <link name='front_l_link'>
    <pose frame=''>0 0 0 0 -0 0</pose>
    <inertial>
      <pose frame=''>0.084 0 -0.021 0 -0 0</pose>
      <mass value="0.5"/>
      <inertia ixx="0.1" ixy="0" ixz="0" iyy="1.4" iyz="0" izz="1.4"/>
    </inertial>
    <visual>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <geometry>
        <mesh filename="package://usv_sim/meshes/naiad/frontLeft.dae" scale="0.21 0.21 0.21"/>
      </geometry>
    </visual>
    <collision>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <geometry>
        <mesh filename="package://usv_sim/meshes/naiad/frontLeft.dae" />
      </geometry>
    </collision>
    <buoyancy>
      <compensation>${front_water_displaced_mass/front_body_mass}</compensation>
      <origin xyz="0 0 0"/>
      <limit radius="0.1"/>
      <damping rpy="${angularDampingXYZ}" xyz="${dampingXYZ}"/>
      <windVelocity>${windType}</windVelocity>
      <frontal_area>0.0</frontal_area>
      <lateral_area>0.012</lateral_area>
      <lateral_length>1.06</lateral_length>
      <waterVelocity>${waterType}</waterVelocity>
    </buoyancy>
  </link>

  <link name='front_r_link'>
    <pose frame=''>0 0 0 0 -0 0</pose>
    <inertial>
      <pose frame=''>0.084 0 -0.021 0 -0 0</pose>
      <mass value="0.5"/>
      <inertia ixx="0.1" ixy="0" ixz="0" iyy="1.4" iyz="0" izz="1.4"/>
    </inertial>
    <visual>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <geometry>
        <mesh filename="package://usv_sim/meshes/naiad/frontRight.dae" scale="0.21 0.21 0.21"/>
      </geometry>
    </visual>
    <collision>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <geometry>
        <mesh filename="package://usv_sim/meshes/naiad/frontRight.dae" />
      </geometry>
    </collision>
    <buoyancy>
      <compensation>${front_water_displaced_mass/front_body_mass}</compensation>
      <origin xyz="0 0 0"/>
      <limit radius="0.1"/>
      <damping rpy="${angularDampingXYZ}" xyz="${dampingXYZ}"/>
      <windVelocity>${windType}</windVelocity>
      <frontal_area>0.0</frontal_area>
      <lateral_area>0.012</lateral_area>
      <lateral_length>1.06</lateral_length>
      <waterVelocity>${waterType}</waterVelocity>
    </buoyancy>
  </link>

  <!--
    <link name='fwd_left'>
    <pose frame=''>0.053619 0.043999 -0.1 3.14159 -1.3108 3.14159</pose>
    <inertial>
    <pose frame=''>-0.042 0 0.063 0 -0 0</pose>
    <mass value="0.1"/>
    <inertia ixx="0.1" ixy="0" ixz="0" iyy="0.1" iyz="0" izz="0.1"/>
    </inertial>
    <visual>
    <pose frame=''>-0.0315 0 0 0 -0 0</pose>
    <geometry>
    <mesh filename="package://usv_sim/meshes/simpleHull3/thruster.dae" scale="0.21 0.21 0.21"/>
    </geometry>
    </visual>
    <collision>
    <pose frame=''>-0.0315 0 0 0 -0 0</pose>
    <geometry>
    <mesh filename="package://usv_sim/meshes/simpleHull3/thruster.dae" />
    </geometry>
    </collision>
    </link>

    <link name='fwd_right'>
    <pose frame=''>0.053604 -0.04615 -0.1 3.14159 -1.3108 3.14159</pose>
    <inertial>
    <pose frame=''>-0.042 0 0.063 0 -0 0</pose>
    <mass value="0.1"/>
    <inertia ixx="0.1" ixy="0" ixz="0" iyy="0.1" iyz="0" izz="0.1"/>
    </inertial>
    <visual>
    <pose frame=''>-0.0315 0 0 0 -0 0</pose>
    <geometry>
    <mesh filename="package://usv_sim/meshes/simpleHull3/thruster.dae" scale="0.21 0.21 0.21"/>
    </geometry>
    </visual>
    <collision>
    <pose frame=''>-0.0315 0 0 0 -0 0</pose>
    <geometry>
    <mesh filename="package://usv_sim/meshes/simpleHull3/thruster.dae"/>
    </geometry>
    </collision>
    </link>
  -->

    <joint name='back_l_joint' type='revolute'>
      <parent link="base_link"/>
      <child link="back_l_link"/>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <limit effort="50" velocity="5" lower="0" upper="0" />
      <dynamics damping="1.0"/>
      <axis xyz="1 0 0"/>
    </joint>

    <joint name='back_r_joint' type='revolute'>
      <parent link="base_link"/>
      <child link="back_r_link"/>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <limit effort="50" velocity="5" lower="0" upper="0" />
      <dynamics damping="1.0"/>
      <axis xyz="1 0 0"/>
    </joint>

    <joint name='center_r_joint' type='revolute'>
      <parent link="base_link"/>
      <child link="center_r_link"/>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <limit effort="50" velocity="5" lower="0" upper="0" />
      <dynamics damping="1.0"/>
      <axis xyz="1 0 0"/>
    </joint>

    <joint name='front_l_joint' type='revolute'>
      <parent link="base_link"/>
      <child link="front_l_link"/>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <limit effort="50" velocity="5" lower="0" upper="0" />
      <dynamics damping="1.0"/>
      <axis xyz="1 0 0"/>
    </joint>

    <joint name='front_r_joint' type='revolute'>
      <parent link="base_link"/>
      <child link="front_r_link"/>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <limit effort="50" velocity="5" lower="0" upper="0" />
      <dynamics damping="1.0"/>
      <axis xyz="1 0 0"/>
    </joint>

    <!--
      <joint name='fwd_left_joint' type='revolute'>
      <parent link="back_l_link"/>
      <child link="fwd_left"/>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <limit effort="50" velocity="5" lower="0" upper="0" />
      <dynamics damping="1.0"/>
      <xyz>-0.257081 0 0.96639</xyz>
      </joint>

      <joint name='fwd_right_joint' type='revolute'>
      <parent link="back_r_link"/>
      <child link="fwd_right"/>
      <pose frame=''>0 0 0 0 -0 0</pose>
      <limit effort="50" velocity="5" lower="0" upper="0" />
      <dynamics damping="1.0"/>
      <xyz>-0.257081 0 0.96639</xyz>
      </joint>
    -->

      <plugin name='freefloating_gazebo_control' filename='libfreefloating_gazebo_control.so'>
        <switchService>switch</switchService>
        <updateRate>100</updateRate>
        <link>fwd_left</link>
        <thruster>
          <effortUnderWater>11.5</effortUnderWater>
          <effortOverWater>0</effortOverWater>
          <name>fwd_left</name>
        </thruster>
        <thruster>
          <effortUnderWater>11.5</effortUnderWater>
          <effortOverWater>0</effortOverWater>
          <name>fwd_right</name>
        </thruster>
        <robotNamespace>/</robotNamespace>
      </plugin>

      <!-- Thruster link -->
      <xacro:macro name="thruster_link" params="name xyz rpy rotationAxis effort:=50 velocity:=5 lowerLimit upperLimit parentLink:=back_r_link thruster_scale:=0.02">
        <joint name="${name}_joint" type="revolute">
          <parent link="${parentLink}"/>
          <child link="${name}"/>
          <origin rpy="${rpy}" xyz="${xyz}"/>
          <dynamics damping="1.0"/>
          <axis xyz="${rotationAxis}"/>
          <limit effort="${effort}" velocity="${velocity}" lower="${lowerLimit}" upper="${upperLimit}" />
        </joint>

        <link name="${name}">      
          <collision>
            <origin xyz="${0*thruster_scale} 0 ${0*thruster_scale}" rpy="0 0 0"/>
            <geometry>
              <mesh filename="package://usv_sim/meshes/simpleHull3/airPropeller.dae" scale="${thruster_scale} ${thruster_scale} ${thruster_scale}"/>
            </geometry>
          </collision>

          <visual name="${name}">
            <origin xyz="${0*thruster_scale} 0 ${0*thruster_scale}" rpy="0 0 0" />
            <geometry>
              <mesh filename="package://usv_sim/meshes/simpleHull3/airPropeller.dae" scale="${thruster_scale} ${thruster_scale} ${thruster_scale}"/>
            </geometry>
            <material name="black">
              <color rgba="255 255 255 1"/>
            </material>
          </visual>  

          <inertial>
            <mass value="0.1"/>
            <origin xyz="${-0.2*thruster_scale} 0 ${0.3*thruster_scale}" rpy="0 0 0" />
            <inertia
              ixx=".1"
              ixy="0.0"
              ixz="0.0"
              iyy=".1"
              iyz="0.0"
              izz=".1"/>
          </inertial>  
          <buoyancy>
            <compensation>0.8</compensation>
            <windVelocity>${windType}</windVelocity>
            <waterVelocity>${waterType}</waterVelocity>
          </buoyancy>
        </link>                 

        <gazebo reference="${name}">
          <material>Gazebo/Black</material>
        </gazebo>
      </xacro:macro>                   


      <!-- Thruster link -->
      <xacro:macro name="thruster_dummy_link" params="name xyz rpy">        
        <joint name="${name}" type="fixed">
          <parent link="base_link"/>
          <child link="${name}"/>
          <origin rpy="${rpy}" xyz="${xyz}"/>
        </joint>
        <link name="${name}"/>
      </xacro:macro>  

      <!-- Sensors -->

    </xacro>
